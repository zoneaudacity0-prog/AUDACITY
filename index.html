<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bank Statement Dashboard</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
    body { margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f6f8; }
    .dashboard { display: flex; min-height: 100vh; }
    .sidebar { width: 250px; background: #1f2937; color: white; display: flex; flex-direction: column; }
    .sidebar h2 { text-align: center; padding: 20px 0; font-weight: 600; border-bottom: 1px solid #374151; }
    .nav { flex: 1; display: flex; flex-direction: column; }
    .nav button { padding: 15px 20px; border: none; background: none; color: white; text-align: left; cursor: pointer; font-size: 16px; transition: 0.2s; }
    .nav button:hover { background: #374151; }
    .content { flex: 1; padding: 20px; overflow-x: auto; }
    .hidden { display: none; }
    .upload-area { border: 2px dashed #9ca3af; padding: 30px; text-align: center; background: #fff; border-radius: 8px; cursor: pointer; }
    .upload-area.dragover { background: #e5e7eb; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #fff; border-radius: 8px; overflow: hidden; }
    th, td { padding: 12px 15px; border-bottom: 1px solid #e5e7eb; text-align: center; }
    th { background: #1f2937; color: white; }
    tfoot td { font-weight: bold; background: #f3f4f6; }
    button.analyze { margin-top: 20px; padding: 12px 20px; font-size: 16px; cursor: pointer; background: #3b82f6; color: white; border: none; border-radius: 5px; transition: 0.2s; }
    button.analyze:hover { background: #2563eb; }
</style>
</head>
<body>

<div class="dashboard">
    <div class="sidebar">
        <h2>Dashboard</h2>
        <div class="nav">
            <button onclick="showModule('moduleA')">A: OCR Upload</button>
            <button onclick="showModule('moduleB')">B: AI Arrears Interpretation</button>
            <button onclick="showModule('moduleC')">C: Report Generator</button>
        </div>
    </div>
    <div class="content">
        <!-- Module A -->
        <div id="moduleA">
            <h2>Upload Bank Statement (Excel/CSV)</h2>
            <div class="upload-area" id="uploadArea">
                Drag & Drop or Click to Upload
                <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" style="display:none;">
            </div>
            <button class="analyze" onclick="analyzeFile()">Analyze Statement</button>
            <div id="tableContainer"></div>
        </div>
        <!-- Module B -->
        <div id="moduleB" class="hidden"><h2>AI Arrears Interpretation (Coming Soon)</h2></div>
        <!-- Module C -->
        <div id="moduleC" class="hidden"><h2>Report Generator (Coming Soon)</h2></div>
    </div>
</div>

<script>
let selectedFile;

const uploadArea = document.getElementById('uploadArea');
const fileInput = document.getElementById('fileInput');

uploadArea.addEventListener('click', () => fileInput.click());

uploadArea.addEventListener('dragover', e => {
    e.preventDefault();
    uploadArea.classList.add('dragover');
});

uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));

uploadArea.addEventListener('drop', e => {
    e.preventDefault();
    uploadArea.classList.remove('dragover');
    selectedFile = e.dataTransfer.files[0];
});

fileInput.addEventListener('change', e => selectedFile = e.target.files[0]);

function showModule(moduleId){
    document.getElementById('moduleA').classList.add('hidden');
    document.getElementById('moduleB').classList.add('hidden');
    document.getElementById('moduleC').classList.add('hidden');
    document.getElementById(moduleId).classList.remove('hidden');
}

function analyzeFile(){
    if(!selectedFile){
        alert("Please upload a file first!");
        return;
    }

    const reader = new FileReader();
    reader.onload = function(e){
        let data = e.target.result;
        let workbook = XLSX.read(data, {type: 'binary'});
        let firstSheet = workbook.SheetNames[0];
        let sheetData = XLSX.utils.sheet_to_json(workbook.Sheets[firstSheet], {header:1});

        processBankData(sheetData);
    };
    reader.readAsBinaryString(selectedFile);
}

function processBankData(sheetData){
    // Find column indices for Month, Debit, Credit
    let header = sheetData[0].map(h => h.toString().toLowerCase());
    let monthIdx = header.findIndex(h => h.includes('month'));
    let debitIdx = header.findIndex(h => h.includes('debit'));
    let creditIdx = header.findIndex(h => h.includes('credit'));

    if(monthIdx === -1 || debitIdx === -1 || creditIdx === -1){
        alert("Columns 'Month', 'Debit', or 'Credit' not found!");
        return;
    }

    let tableHTML = `<table>
        <thead>
            <tr>
                <th>S/N</th>
                <th>Month</th>
                <th>Debit</th>
                <th>Credit</th>
            </tr>
        </thead>
        <tbody>`;

    let totalDebit = 0, totalCredit = 0;

    sheetData.slice(1).forEach((row, idx) => {
        let month = row[monthIdx] || '';
        let debit = parseNumber(row[debitIdx]);
        let credit = parseNumber(row[creditIdx]);
        totalDebit += debit;
        totalCredit += credit;

        tableHTML += `<tr>
            <td>${idx+1}</td>
            <td>${month}</td>
            <td>${formatNumber(debit)}</td>
            <td>${formatNumber(credit)}</td>
        </tr>`;
    });

    let rowCount = sheetData.length - 1;

    tableHTML += `</tbody>
        <tfoot>
            <tr>
                <td colspan="2">Total</td>
                <td>${formatNumber(totalDebit)}</td>
                <td>${formatNumber(totalCredit)}</td>
            </tr>
            <tr>
                <td colspan="2">Average</td>
                <td>${formatNumber(totalDebit/rowCount)}</td>
                <td>${formatNumber(totalCredit/rowCount)}</td>
            </tr>
        </tfoot>
    </table>`;

    document.getElementById('tableContainer').innerHTML = tableHTML;
}

function parseNumber(val){
    if(!val) return 0;
    return Number(val.toString().replace(/,/g,'').replace(/\s/g,''));
}

function formatNumber(num){
    return num.toLocaleString('en-US');
}
</script>

</body>
</html>
