<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Financial Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
  <div class="flex min-h-screen">

    <!-- Sidebar -->
    <aside class="w-64 bg-white shadow-md p-6 flex flex-col">
      <h1 class="text-2xl font-bold mb-6">Dashboard</h1>
      <nav class="flex flex-col space-y-4">
        <button onclick="showModule('moduleA')" class="hover:bg-gray-200 p-2 rounded text-left">OCR Upload</button>
        <button onclick="showModule('moduleB')" class="hover:bg-gray-200 p-2 rounded text-left">AI Statement Analysis</button>
        <button onclick="showModule('moduleC')" class="hover:bg-gray-200 p-2 rounded text-left">Report Generator</button>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-6">
      <!-- Module A: OCR Upload -->
      <section id="moduleA" class="module">
        <h2 class="text-xl font-bold mb-4">Upload Bank Statement</h2>
        <div class="border-2 border-dashed border-gray-400 p-6 rounded bg-white text-center mb-4">
          <input type="file" id="fileInput" accept=".xlsx,.xls,.csv,.pdf" class="w-full cursor-pointer" multiple>
          <p class="mt-2 text-gray-500">Drag & drop Excel or PDF files here</p>
        </div>
        <button onclick="processFiles()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Analyze Statement</button>
      </section>

      <!-- Module B: AI Statement Analysis -->
      <section id="moduleB" class="module hidden">
        <h2 class="text-xl font-bold mb-4">AI Statement Analysis</h2>
        <p class="mb-2">This simulates AI analyzing your uploaded statement.</p>
        <button onclick="generateSummary()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 mb-4">Run Analysis</button>
        <pre id="analysisOutput" class="bg-white p-4 rounded shadow overflow-x-auto"></pre>
      </section>

      <!-- Module C: Report Generator -->
      <section id="moduleC" class="module hidden">
        <h2 class="text-xl font-bold mb-4">Cash Flow Summary Report</h2>
        <div class="overflow-x-auto bg-white p-4 rounded shadow">
          <h3 class="font-bold mb-2">CASH FLOW SUMMARY - CRDB BANK</h3>
          <h4 class="mb-4">PREMIER GIRLS SEC SCHOOL 2024-2025</h4>
          <table class="min-w-full border border-gray-300">
            <thead class="bg-gray-100">
              <tr>
                <th class="border px-4 py-2">S/N</th>
                <th class="border px-4 py-2">Month</th>
                <th class="border px-4 py-2">Debit</th>
                <th class="border px-4 py-2">Credit</th>
              </tr>
            </thead>
            <tbody id="reportTable" class="text-gray-700">
              <!-- Rows will be dynamically added -->
            </tbody>
            <tfoot class="bg-gray-100 font-bold">
              <tr>
                <td colspan="2" class="border px-4 py-2 text-right">Total</td>
                <td id="totalDebit" class="border px-4 py-2"></td>
                <td id="totalCredit" class="border px-4 py-2"></td>
              </tr>
              <tr>
                <td colspan="2" class="border px-4 py-2 text-right">Average</td>
                <td id="avgDebit" class="border px-4 py-2"></td>
                <td id="avgCredit" class="border px-4 py-2"></td>
              </tr>
            </tfoot>
          </table>
        </div>
      </section>
    </main>
  </div>

<script>
  const modules = document.querySelectorAll('.module');

  function showModule(moduleId) {
    modules.forEach(mod => mod.classList.add('hidden'));
    document.getElementById(moduleId).classList.remove('hidden');
  }

  let uploadedData = [];

  function processFiles() {
    const files = document.getElementById('fileInput').files;
    if (!files.length) return alert('Please select files first.');

    uploadedData = [];
    for (let file of files) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, {type:'array'});
        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
        const sheetData = XLSX.utils.sheet_to_json(firstSheet, {header:1});
        uploadedData.push(...sheetData);
      }
      reader.readAsArrayBuffer(file);
    }
    alert('Files uploaded successfully!');
    showModule('moduleB');
  }

  function generateSummary() {
    if (!uploadedData.length) return alert('No data uploaded.');
    
    // Simulated parsing: assumes first row header and format [S/N, Month, Debit, Credit]
    const rows = uploadedData.slice(1).map((row,i) => ({
      sn: i+1,
      month: row[0] || `Month-${i+1}`,
      debit: parseFloat(row[1] || 0),
      credit: parseFloat(row[2] || 0)
    }));

    // Calculate totals
    const totalDebit = rows.reduce((sum,r)=> sum + r.debit,0);
    const totalCredit = rows.reduce((sum,r)=> sum + r.credit,0);
    const avgDebit = (totalDebit / rows.length).toFixed(2);
    const avgCredit = (totalCredit / rows.length).toFixed(2);

    // Populate report table
    const tbody = document.getElementById('reportTable');
    tbody.innerHTML = '';
    rows.forEach(r => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td class="border px-4 py-2">${r.sn}</td>
                      <td class="border px-4 py-2">${r.month}</td>
                      <td class="border px-4 py-2">${r.debit.toLocaleString()}</td>
                      <td class="border px-4 py-2">${r.credit.toLocaleString()}</td>`;
      tbody.appendChild(tr);
    });

    document.getElementById('totalDebit').textContent = totalDebit.toLocaleString();
    document.getElementById('totalCredit').textContent = totalCredit.toLocaleString();
    document.getElementById('avgDebit').textContent = avgDebit.toLocaleString();
    document.getElementById('avgCredit').textContent = avgCredit.toLocaleString();

    showModule('moduleC');
  }
</script>
</body>
</html>
