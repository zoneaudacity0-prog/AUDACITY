<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audacity Zone – Financial AI Engine</title>

    <!-- Styles -->
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: #f7f8fa;
        }

        header {
            background: #111827;
            padding: 20px;
            color: white;
            display: flex;
            justify-content: space-between;
        }

        nav a {
            color: white;
            margin-left: 20px;
            text-decoration: none;
            font-weight: bold;
        }

        .section {
            padding: 50px;
            background: white;
            margin: 20px;
            border-radius: 10px;
        }

        .upload-box {
            border: 2px dashed #4b5563;
            padding: 40px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            background: #f9fafb;
        }

        button {
            padding: 12px 22px;
            background: #111827;
            color: white;
            border: none;
            border-radius: 7px;
            cursor: pointer;
        }

        button:hover {
            background: #1f2937;
        }

        h2 {
            margin-bottom: 10px;
            color: #111827;
        }
    </style>

    <!-- PapaParse CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <!-- XLSX Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Tesseract OCR -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.4/dist/tesseract.min.js"></script>
</head>
<body>

<header>
    <div style="font-size: 22px; font-weight: bold;">AUDACITY ZONE</div>
    <nav>
        <a href="#statement">Statement Analysis</a>
        <a href="#ocr">Ledger OCR (A)</a>
        <a href="#interpret">AI Ledger Interpretation (B)</a>
        <a href="#report">Report Generator (C)</a>
    </nav>
</header>

<!-- MAIN FEATURE SECTION -->
<section id="statement" class="section">
    <h2>Bank Statement Analysis (MAIN SYSTEM)</h2>
    <p>Upload your bank statement (PDF, Excel, CSV) and get summarized totals per month.</p>

    <label>Statement Reference Name</label><br>
    <input id="statementName" style="width: 60%; padding: 10px; margin: 10px 0;"> <br><br>

    <div class="upload-box" onclick="document.getElementById('statementFile').click()">
        Drop a file here or click to upload
    </div>
    <input type="file" id="statementFile" accept=".csv,.xlsx,.xls,.pdf" style="display:none">

    <br><button onclick="analyzeStatement()">Analyze Statement</button>

    <div id="statementOutput" style="margin-top: 30px;"></div>
</section>

<!-- A: OCR MODULE -->
<section id="ocr" class="section">
    <h2>Module A – OCR Ledger Extraction</h2>
    <p>Upload a loan ledger (PDF/Image) to extract raw ledger text using OCR.</p>

    <div class="upload-box" onclick="document.getElementById('ocrFile').click()">
        Upload ledger PDF / Image for OCR
    </div>
    <input type="file" id="ocrFile" accept=".pdf,.jpg,.jpeg,.png" style="display:none">

    <br><button onclick="runOCR()">Run OCR</button>

    <pre id="ocrOutput" style="
        background:#000;
        color:#0f0;
        padding:20px;
        border-radius:6px;
        margin-top:20px;
        height:200px;
        overflow:auto;
    "></pre>
</section>

<!-- B: AI INTERPRETATION -->
<section id="interpret" class="section">
    <h2>Module B – AI Ledger Interpretation</h2>

    <p>This module reads OCR text and identifies:</p>
    <ul>
        <li>Total arrears</li>
        <li>Days in arrears</li>
        <li>Principal in arrears</li>
        <li>Default interest</li>
        <li>Behavioral patterns</li>
    </ul>

    <button onclick="interpretLedger()">Interpret Ledger</button>

    <div id="interpretOutput" style="margin-top:20px; white-space:pre-line;"></div>
</section>

<!-- C: REPORT GENERATOR -->
<section id="report" class="section">
    <h2>Module C – Final Report Generator</h2>

    <p>Generate a downloadable Excel report of all analysis.</p>

    <button onclick="downloadExcel()">Download Excel Report</button>

    <div id="reportSummary" style="margin-top:20px;"></div>
</section>

<script>
/* ------------------------------------------
   MAIN STATEMENT ANALYSIS
------------------------------------------- */
function analyzeStatement() {
    document.getElementById("statementOutput").innerHTML =
        "<h3>Processing Statement…</h3>";

    let file = document.getElementById("statementFile").files[0];
    if (!file) {
        alert("Please upload a file first.");
        return;
    }

    if (file.name.endsWith(".csv")) {
        Papa.parse(file, {
            header: true,
            complete: function (results) {
                let data = results.data;
                processCSV(data);
            }
        });
    } else {
        document.getElementById("statementOutput").innerHTML =
            "<p>Excel/PDF processing will be added in backend.</p>";
    }
}

function processCSV(data) {
    let monthly = {};

    data.forEach(row => {
        let date = row.Date || row.date;
        let debit = parseFloat(row.Debit || 0);
        let credit = parseFloat(row.Credit || 0);

        if (!date) return;

        let month = date.substring(0, 7);

        if (!monthly[month]) monthly[month] = { debit: 0, credit: 0 };
        monthly[month].debit += debit;
        monthly[month].credit += credit;
    });

    let html = "<h3>Summary</h3><table border='1' cellpadding='5'><tr><th>Month</th><th>Total Debit</th><th>Total Credit</th></tr>";

    Object.keys(monthly).forEach(m => {
        html += `<tr>
            <td>${m}</td>
            <td>${monthly[m].debit.toFixed(2)}</td>
            <td>${monthly[m].credit.toFixed(2)}</td>
        </tr>`;
    });

    html += "</table>";

    document.getElementById("statementOutput").innerHTML = html;
}

/* ------------------------------------------
   A: OCR
------------------------------------------- */
function runOCR() {
    let file = document.getElementById("ocrFile").files[0];
    if (!file) {
        alert("Upload a ledger first.");
        return;
    }

    document.getElementById("ocrOutput").textContent = "Running OCR...";

    Tesseract.recognize(file, "eng").then(result => {
        document.getElementById("ocrOutput").textContent =
            result.data.text;
        window.OCR_TEXT = result.data.text;
    });
}

/* ------------------------------------------
   B: AI INTERPRETATION (Placeholder)
------------------------------------------- */
function interpretLedger() {
    if (!window.OCR_TEXT) {
        alert("Run OCR first.");
        return;
    }

    let text = window.OCR_TEXT;

    document.getElementById("interpretOutput").textContent =
        "AI Interpretation (Mock):\n\n" +
        "- Estimated Arrears: 1,200,000\n" +
        "- Estimated Days in Arrears: 37 days\n" +
        "- Principal in Arrears: 950,000\n" +
        "- Default Interest Estimate: 6,500\n" +
        "- Risk Level: MEDIUM\n\n" +
        "Full AI model will refine this when backend is connected.";
}

/* ------------------------------------------
   C: DOWNLOAD EXCEL
------------------------------------------- */
function downloadExcel() {
    let wb = XLSX.utils.book_new();
    let ws = XLSX.utils.aoa_to_sheet([
        ["Audacity Zone Report"],
        ["Generated:", new Date().toLocaleString()],
        [],
        ["Item", "Value"],
        ["Arrears", "1,200,000"],
        ["Days in Arrears", "37"],
        ["Principal in Arrears", "950,000"],
        ["Default Interest", "6,500"]
    ]);

    XLSX.utils.book_append_sheet(wb, ws, "Report");
    XLSX.writeFile(wb, "AudacityZone_Report.xlsx");
}
</script>
</body>
</html>
