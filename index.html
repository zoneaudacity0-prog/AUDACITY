<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AUDACITY ZONE â€” Bank Statement Monthly Summary</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
  body { font-family: 'Inter', sans-serif; background: #f7f8fa; color: #1a1a1a; }
  nav { display: flex; justify-content: space-between; padding: 20px 50px; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,0.1); position:sticky; top:0; z-index:100;}
  .logo { font-weight:700; color:#0d6efd; font-size:1.8rem; }
  .upload-section { text-align:center; padding:50px; }
  input, button { padding:10px; margin:10px 0; border-radius:6px; font-size:1rem; }
  button { background:#0d6efd; color:#fff; border:none; cursor:pointer; }
  button:hover { background:#0956c1; }
  table { width:90%; margin:30px auto; border-collapse:collapse; background:#fff; border-radius:8px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.05);}
  th, td { padding:12px 15px; text-align:center; border-bottom:1px solid #ddd; }
  th { background:#0d6efd; color:#fff; }
  tfoot td { font-weight:700; }
</style>
</head>
<body>

<nav><div class="logo">AUDACITY ZONE</div></nav>

<section class="upload-section">
  <h2>Upload Bank Statement</h2>
  <input type="file" id="fileInput" accept=".xlsx,.xls,.csv">
  <br>
  <input type="text" id="statementName" placeholder="Enter Statement Name">
  <br>
  <button onclick="analyzeStatement()">Analyze</button>

  <div id="summary"></div>
</section>

<script>
function formatNumber(num){
  return Number(num).toLocaleString('en-US', {maximumFractionDigits:2});
}

async function analyzeStatement(){
  const fileInput = document.getElementById('fileInput');
  const statementName = document.getElementById('statementName').value.trim();
  const summaryDiv = document.getElementById('summary');
  summaryDiv.innerHTML = "";

  if(!fileInput.files.length){ alert("Please select a file"); return; }
  if(!statementName){ alert("Please enter statement name"); return; }

  const file = fileInput.files[0];
  try {
    const data = await file.arrayBuffer();
    const workbook = XLSX.read(data);
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const json = XLSX.utils.sheet_to_json(sheet, {defval:""});

    if(json.length===0){ summaryDiv.innerHTML="<p>No data found.</p>"; return; }

    // Detect columns
    const headers = Object.keys(json[0]);
    const dateCol = headers.find(h => /date/i.test(h));
    const debitCol = headers.find(h => /debit/i.test(h));
    const creditCol = headers.find(h => /credit/i.test(h));

    if(!dateCol || !debitCol || !creditCol){
      summaryDiv.innerHTML="<p>Could not detect Date, Debit, or Credit columns. Make sure your file contains these columns.</p>";
      return;
    }

    // Aggregate per month
    const monthly = {};
    json.forEach(row=>{
      const date = new Date(row[dateCol]);
      if(!isNaN(date)){
        const monthKey = `${date.toLocaleString('en-US',{month:'short'})}-${date.getFullYear()}`;
        if(!monthly[monthKey]) monthly[monthKey] = {Debit:0, Credit:0};
        monthly[monthKey].Debit += parseFloat(row[debitCol])||0;
        monthly[monthKey].Credit += parseFloat(row[creditCol])||0;
      }
    });

    const months = Object.keys(monthly).sort((a,b)=>{
      const [m1,y1] = a.split('-'); const [m2,y2] = b.split('-');
      const d1 = new Date(`${m1} 1, ${y1}`); const d2 = new Date(`${m2} 1, ${y2}`);
      return d1-d2;
    });

    // Build table
    let table = `<table>
      <thead><tr><th>S/N</th><th>Month</th><th>Debit</th><th>Credit</th></tr></thead><tbody>`;
    let totalDebit = 0, totalCredit=0;
    months.forEach((month,i)=>{
      const debit = monthly[month].Debit;
      const credit = monthly[month].Credit;
      totalDebit += debit;
      totalCredit += credit;
      table += `<tr><td>${i+1}</td><td>${month}</td><td>${formatNumber(debit)}</td><td>${formatNumber(credit)}</td></tr>`;
    });
    const avgDebit = totalDebit/months.length;
    const avgCredit = totalCredit/months.length;
    table += `<tfoot>
      <tr><td colspan="2">TOTAL</td><td>${formatNumber(totalDebit)}</td><td>${formatNumber(totalCredit)}</td></tr>
      <tr><td colspan="2">AVERAGE</td><td>${formatNumber(avgDebit)}</td><td>${formatNumber(avgCredit)}</td></tr>
    </tfoot></tbody></table>`;

    summaryDiv.innerHTML = `<h3>Monthly Summary for "${statementName}"</h3>` + table;

  } catch(err){
    console.error(err);
    summaryDiv.innerHTML="<p>Error reading file: "+err.message+"</p>";
  }
}
</script>

</body>
</html>
